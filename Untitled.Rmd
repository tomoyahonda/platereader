---
title: "Reading growth data in plate reader"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is a documentation for how to read a large set of growth data and extract important physiological parameters. 
```{r}
# be careful to change column name first so that they can be read
df <- read.csv("PlateReader_Growth_MG & RP.csv", header = TRUE, check.names=FALSE)
```

Below is a format of raw data from a plate reader.
```{r echo = FALSE, results = 'asis'}
library(knitr)
kable(df[1:10, 1:7], caption = "raw growth data")
```

Now change the time values from min to hr, and extract background values based on the first measurement. 
```{r}
#change time to hr
df$Time <- df$Time/60/60 

# calibrate OD value from plate reader to OD spec
for (i in seq(4, length(df[,4:ncol(df)])+3)) {
  df[,i] <- (df[,i]-df[1,i])*2.14 #substruct background OD and convert to OD600 value in spec.
      for (j in seq(1, nrow(df))) {
        if (df[j,i] > 0.06 & df[j,i] < 0.4) { #extract values from OD 0.02 to 0.2
          df[j,i] <- df[j,i]
        }
        else {
          df[j,i] <- NA
        }
      }
}
```

## creating Plots
```{r pressure, echo=FALSE}
# plot growth curves for all columns
par(mfrow=c(2,2))
par(new=FALSE)
for (i in seq(4, length(df[,4:ncol(df)])+3)) {
  plot(df$Time, df[,i], xlim=c(0,24), ylim=c(0.01,1), log="y", xaxs = "i", yaxs = "i" ,
       xlab = "time [hr]", ylab = "OD600", cex.lab=1, cex.axis=1,
       col="black", cex=1, pch=1, main = colnames(df[i])) 
  fit <- lm(log(df[,i]) ~ df$Time)
  abline(lm(log10(df[,i]) ~ df$Time), lty=2, "black") # the base of line is log10
  text(0, 0.5, paste(" slope:", fit$coefficients[2]), pos=4) # the base of slope is natural log
  par(new=FALSE)
}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}
### plot growth curves for each 7AA and 16AA at 1mM ### 
par(mfrow=c(4,4))
par(new=FALSE)
for (i in seq(4, length(df[,4:7])+3)) { #for glycerol
  plot(df$Time, df[,i], xlim=c(0,12), ylim=c(0.01,1), log="y", xaxs = "i", yaxs = "i" ,
       xlab = "time [hr]", ylab = "OD600", cex.lab=1.5, cex.axis=1.5,
       col="black", cex=2, pch=1, main = colnames(df[i])) 
  points(df$Time, df[,4], col="red", type="l") 
  par(new=FALSE)
}

par(new=FALSE)
for (i in seq(8, length(df[,8:11])+7)) { #for 7 non-degradable AA
  plot(df$Time, df[,i], xlim=c(0,12), ylim=c(0.01,1), log="y", xaxs = "i", yaxs = "i" ,
       xlab = "time [hr]", ylab = "OD600", cex.lab=1.5, cex.axis=1.5,
       col="black", cex=2, pch=1, main = colnames(df[i])) 
  points(df$Time, df[,8], col="blue", type="l") 
  par(new=FALSE)
}

for (i in seq(12, length(df[,12:15])+11)) { #for 16AA
  plot(df$Time, df[,i], xlim=c(0,12), ylim=c(0.01,1), log="y", xaxs = "i", yaxs = "i" ,
       xlab = "time [hr]", ylab = "OD600", cex.lab=1.5, cex.axis=1.5,
       col="black", cex=2, pch=1, main = colnames(df[i])) 
  points(df$Time, df[,12], col="green", type="l") 
  par(new=FALSE)
}

for (i in seq(16, length(df[,16:19])+15)) { #for glpK22
  plot(df$Time, df[,i], xlim=c(0,12), ylim=c(0.01,1), log="y", xaxs = "i", yaxs = "i" ,
       xlab = "time [hr]", ylab = "OD600", cex.lab=1.5, cex.axis=1.5,
       col="black", cex=2, pch=1, main = colnames(df[i])) 
  points(df$Time, df[,16], col="purple", type="l") 
  par(new=FALSE)
}
```


